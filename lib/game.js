// Generated by CoffeeScript 1.9.3
var Game;

Game = (function() {
  function Game(canvas) {
    this.board = new Board();
    this.board.add_pieces();
    this.canvas = canvas;
    this.ctx = this.canvas.getContext("2d");
    console.log(this.board.cols);
    this.interval = setInterval(((function(_this) {
      return function() {
        return _this.render();
      };
    })(this)), 100);
    this.incr = setInterval(((function(_this) {
      return function() {
        return _this.board.add_pieces();
      };
    })(this)), 1000);
    this.resize();
    $(window).on("resize", ((function(_this) {
      return function() {
        return _this.resize();
      };
    })(this)));
    $(this.canvas).on("click", ((function(_this) {
      return function(e) {
        return _this.click(e);
      };
    })(this)));
    this.colors = ["red", "green", "blue", "yellow", "orange", "pink", "purple"];
  }

  Game.prototype.click = function(e) {
    return console.log(e);
  };

  Game.prototype.resize = function() {
    var ref;
    this.scale = parseInt(Math.min(this.canvas.width, this.canvas.height) / Math.max(this.board.size.rows, this.board.size.cols));
    return ref = [this.board.size.cols * this.scale, this.board.size.rows * this.scale], this.width = ref[0], this.height = ref[1], ref;
  };

  Game.prototype.clear = function() {
    this.ctx.fillStyle = "#fff";
    return this.ctx.fillRect(0, 0, this.width, this.height);
  };

  Game.prototype.draw_grid = function() {
    var grid, k, l, ref, ref1, results, x, y;
    this.ctx.strokeStyle = "#eee";
    this.ctx.lineWidth = 1;
    for (grid = k = 0, ref = this.board.size.rows; 0 <= ref ? k <= ref : k >= ref; grid = 0 <= ref ? ++k : --k) {
      y = grid * this.scale;
      this.ctx.beginPath();
      this.ctx.moveTo(0, y);
      this.ctx.lineTo(this.width, y);
      this.ctx.lineWidth = 1;
      this.ctx.strokeStyle = "#eee";
      this.ctx.stroke();
    }
    results = [];
    for (grid = l = 0, ref1 = this.board.size.cols; 0 <= ref1 ? l <= ref1 : l >= ref1; grid = 0 <= ref1 ? ++l : --l) {
      x = grid * this.scale;
      this.ctx.beginPath();
      this.ctx.moveTo(x, 0);
      this.ctx.lineTo(x, this.height);
      this.ctx.lineWidth = 1;
      this.ctx.strokeStyle = "#eee";
      results.push(this.ctx.stroke());
    }
    return results;
  };

  Game.prototype.render = function() {
    var col, i, j, k, piece, ref, results, x, y;
    this.clear();
    this.draw_grid();
    this.ctx.font = (this.scale * 0.66) + "px sans-serif";
    this.ctx.strokeStyle = "#eee";
    this.ctx.textAlign = "center";
    this.ctx.textBaseline = "middle";
    results = [];
    for (i = k = 0, ref = this.board.cols.length - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
      col = this.board.cols[i];
      x = i * this.scale;
      if (col.length) {
        results.push((function() {
          var l, ref1, results1;
          results1 = [];
          for (j = l = 0, ref1 = col.length - 1; 0 <= ref1 ? l <= ref1 : l >= ref1; j = 0 <= ref1 ? ++l : --l) {
            piece = col[j];
            y = this.height - (j * this.scale) - this.scale;
            if (piece) {
              this.ctx.fillStyle = this.colors[piece.value];
              this.ctx.fillRect(x, y, this.scale, this.scale);
              this.ctx.strokeRect(x, y, this.scale, this.scale);
              this.ctx.fillStyle = "#fff";
              results1.push(this.ctx.fillText(piece.value, x + (this.scale / 2), y + (this.scale / 2)));
            } else {
              results1.push(void 0);
            }
          }
          return results1;
        }).call(this));
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  return Game;

})();
